shards, replication, and failover

横向与纵向扩展

# 【ElasticSearch系列连载】6. 通俗易懂的分布式原理

## 简介

对于没有实际使用、调试、开发过分布式系统的人来说，**横向扩展**、**数据分区**、**副本/数据分片**、**容错容灾**, **一致性** 等和分布式相关的概念、词汇可能会感觉十分遥远与深奥。

但是大道至简，殊途同归，相对与不断升级迭代的前端技术升级，目前市面上绝大部分的分布式系统的底层设计思想和理念在近十几年来并没有大的变化，如果我们只关注概念本身，而不是晦涩的技术细节（不同分布式系统的通信协议，实现方案，选举策略，一致性算法，数据分布策略等等），你会发现**分布式**其实是一个很简单，也很优雅、巧妙的设计理念，是任何技术研发都可以也都应该理解的一个技术概念。

本文，就借着ElasticSearch的分布式基础使用，来结合具体案例尝试进行一个通俗易懂的分布式案例解析。

## 关于系统的可扩展性

当系统的计算资源或者存储资源不足的时候，就需要对系统进行扩展，此时系统的可扩展性(scalability)就显得十分重要了。

虽然你可以通过购买更强大的服务器，来提升你的系统能力，但是这个会受限于单服务器的硬件能力。所以真正的横向扩展需要能够通过添加更多的节点/服务器来提升整个系统的能力：通过添加更多的节点，能够将数据存储和计算任务均衡的分布到各个节点上，并保障数据和性能的稳定性。

## 从一个空集群开始-master node

在一开始，我们先启动一个新的节点，没有数据和索引，此时的状态如下图。

![](https://nginx.mostintelligentape.com/blogimg/202206/es_cluster/1.jpeg)

由于目前集群只有一个节点，所以这个节点很自然地被选举为"Master节点"。

> "Master节点"，顾名思义就是主节点，是负责集群层面主要操作的节点，如：索引的创建和删除，节点的添加和删除。另外的操作，比如文档数据的增删改查都不需要它，任何的节点都可以，所以在和数据相关的操作上，只有一个"Master节点"不会成为吞吐量的瓶颈。

作为集群的使用者或者调用方，我们可以和集群的任何一个节点（包括Master）直接进行通信，因为任何一个节点上都记录了所有数据的实际存储位置，并将请求正确的转发到多个对应的节点上，并将返回进行合并后统一返回给调用方。所以任何一个节点都可以承担核心数据的增删改查操作。


只负责集群级别的任务：节点增减，索引增减
不涉及数据
每一个节点都知道每一个数据在哪个节点的，每个节点都可以承接搜索任务，将其转发到多个正确的节点，然后合并返回
ne node in the cluster is elected to be the master node, which is in charge of manag‐ ing cluster-wide changes like creating or deleting an index, or adding or removing a node from the cluster. The master node does not need to be involved in document- level changes or searches, which means that having just one master node will not become a bottleneck as traffic grows. Any node can become the master. Our example cluster has only one node, so it performs the master role.
As users, we can talk to any node in the cluster, including the master node. Every node knows where each document lives and can forward our request directly to the nodes that hold the data we are interested in. Whichever node we talk to manages the pro‐ cess of gathering the response from the node or nodes holding the data and returning the final response to the client. It is all managed transparently by Elasticsearch.


## 集群健康状态检查

## 让索引数据拥有副本

## 集群容灾-新增一个节点

## 继续横向扩展-再加一个节点

## 让索引数据拥有更多副本

## 故障模拟