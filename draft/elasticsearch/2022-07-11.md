# 关于ES数据

## json

index->type->id

version
Every document in Elasticsearch has a version number. Every time a change is made to a document (including deleting it), the _version number is incremented. In “Deal‐ ing with Conflicts” on page 45, we discuss how to use the _version number to ensure that one part of your application doesn’t overwrite changes made by another part.

自动生成id
Autogenerated IDs are 22 character long, URL-safe, Base64-encoded string univer‐ sally unique identifiers, or UUIDs.

## GET获取文档
pretty
获取文档的部分字段：GET /website/blog/123?_source=title,text
甚至只要source：GET /website/blog/123/_source
只检查文档是否存在：curl -i -XHEAD http://localhost:9200/website/blog/123

## UPDATE更新文档
首先，文档本质是只读的，不能修改的。
所以，如果要更新，就要完全替换掉原来的文档。

接口上：
返回的created告诉你是否已经存在
version会增加

更新流程：标记删除 => 添加新文档 => 随着新数据的录入再把标记删除的文档从后台逐步删除

后面有局部更新的接口，逻辑是类似的：获取旧的JSON文档 => 基于旧的和用户提交的进行合并修改 => 标记删除 => 添加新文档 => 随着新数据的录入再把标记删除的文档从后台逐步删除

所以，update就是将get再index整合成为了一个接口

## 创建文档

How can we be sure, when we index a document, that we are creating an entirely new document and not overwriting an existing one?

PUT /website/blog/123?op_type=create
PUT /website/blog/123/_create

If the request succeeds in creating a new document, Elasticsearch will return the usual metadata and an HTTP response code of 201 Created.
On the other hand, if a document with the same _index, _type, and _id already exists, Elasticsearch will respond with a 409 Conflict response code, and an error message like the following:


## 删除文档
As already mentioned in “Updating a Whole Document” on page 42, deleting a document doesn’t immediately remove the docu‐ ment from disk; it just marks it as deleted. Elasticsearch will clean up deleted documents in the background as you continue to index more data.





